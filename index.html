<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Manager - Hariprasad Sivakumar</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Third-party Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Auth Check -->
    <script>
        const auth = localStorage.getItem('isLoggedIn');
        const loginTime = localStorage.getItem('loginTime');
        
        if (!auth || auth !== 'true') {
            window.location.href = 'login.html';
        } else if (loginTime) {
            const hoursDiff = (Date.now() - parseInt(loginTime)) / 3600000;
            if (hoursDiff > 24) {
                ['isLoggedIn', 'username', 'loginTime'].forEach(k => localStorage.removeItem(k));
                window.location.href = 'login.html';
            }
        }
    </script>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">üíº</span>
                    <div>
                        <h2>Invoice Manager</h2>
                        <p>Hariprasad S.</p>
                    </div>
                </div>
                <button class="menu-toggle" id="menuToggle">‚ò∞</button>
            </div>
            
            <div class="user-card">
                <div class="avatar">HS</div>
                <div>
                    <h4>Hariprasad S.</h4>
                    <p>üëã Welcome back!</p>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li><a href="#" class="nav-link active" data-page="dashboard"><span class="icon">üìä</span> Dashboard</a></li>
                <li><a href="#" class="nav-link" data-page="invoices"><span class="icon">üìÑ</span> Invoices</a></li>
                <li><a href="#" class="nav-link" data-page="clients"><span class="icon">üë•</span> Clients</a></li>
                <li><a href="#" class="nav-link" data-page="expenses"><span class="icon">üí∞</span> Expenses</a></li>
                <li><a href="#" class="nav-link" data-page="analytics"><span class="icon">üìà</span> Analytics</a></li>
                <li><a href="#" class="nav-link" data-page="settings"><span class="icon">‚öôÔ∏è</span> Settings</a></li>
            </ul>
            
            <div class="sidebar-footer">
                <button class="btn-logout" id="logoutBtn">
                    <span class="icon">üö™</span> Logout
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboard-page">
                <header class="page-header">
                    <div>
                        <h1>Dashboard</h1>
                        <p>Overview of your business</p>
                    </div>
                    <button class="btn btn-primary" id="create-invoice-btn">
                        <span class="icon">‚ûï</span> Create Invoice
                    </button>
                </header>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon blue">üíµ</div>
                        <div>
                            <p>Total Earnings</p>
                            <h3 id="total-earnings">‚Çπ0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">üìÑ</div>
                        <div>
                            <p>Total Invoices</p>
                            <h3 id="total-invoices">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon purple">üë•</div>
                        <div>
                            <p>Active Clients</p>
                            <h3 id="total-clients">0</h3>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">üìà</div>
                        <div>
                            <p>This Month</p>
                            <h3 id="monthly-earnings">‚Çπ0</h3>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <h3>Monthly Earnings</h3>
                        <canvas id="monthly-chart"></canvas>
                    </div>
                    <div class="card">
                        <h3>Top Clients</h3>
                        <canvas id="client-chart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>Recent Invoices</h3>
                    <div id="recent-invoices" class="table-container"></div>
                </div>
            </div>

            <!-- Invoices Page -->
            <div class="page" id="invoices-page">
                <header class="page-header">
                    <div>
                        <h1>Invoices</h1>
                        <p>Manage your invoices</p>
                    </div>
                    <div class="header-actions">
                        <input type="text" class="search-input" id="invoice-search" placeholder="Search invoices...">
                        <select class="filter-select" id="invoice-status-filter">
                            <option value="">All Status</option>
                            <option value="Draft">Draft</option>
                            <option value="Pending">Pending</option>
                            <option value="Paid">Paid</option>
                            <option value="Overdue">Overdue</option>
                        </select>
                        <button class="btn btn-primary" id="create-invoice-invoices">
                            <span class="icon">‚ûï</span> Create Invoice
                        </button>
                    </div>
                </header>
                <div class="card">
                    <div id="invoices-list" class="table-container"></div>
                </div>
            </div>

            <!-- Clients Page -->
            <div class="page" id="clients-page">
                <header class="page-header">
                    <div>
                        <h1>Clients</h1>
                        <p>Manage your clients</p>
                    </div>
                    <div class="header-actions">
                        <input type="text" class="search-input" id="client-search" placeholder="Search clients...">
                        <button class="btn btn-primary" id="add-client-btn">
                            <span class="icon">‚ûï</span> Add Client
                        </button>
                    </div>
                </header>
                <div class="clients-grid" id="clients-grid"></div>
            </div>

            <!-- Expenses Page -->
            <div class="page" id="expenses-page">
                <!-- Will be dynamically generated -->
            </div>

            <!-- Analytics Page -->
            <div class="page" id="analytics-page">
                <header class="page-header">
                    <div>
                        <h1>Analytics</h1>
                        <p>Business insights and trends</p>
                    </div>
                    <div class="header-actions">
                        <select class="filter-select" id="analytics-period">
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                        <input type="date" class="date-input" id="analytics-from">
                        <input type="date" class="date-input" id="analytics-to">
                        <button class="btn btn-primary" id="apply-filters">Apply</button>
                    </div>
                </header>

                <div class="stats-grid">
                    <div class="stat-card">
                        <p>Revenue</p>
                        <h3 id="analytics-revenue">‚Çπ0</h3>
                    </div>
                    <div class="stat-card">
                        <p>Avg Invoice</p>
                        <h3 id="analytics-avg">‚Çπ0</h3>
                    </div>
                    <div class="stat-card">
                        <p>Paid Rate</p>
                        <h3 id="analytics-paid-rate">0%</h3>
                    </div>
                    <div class="stat-card">
                        <p>Outstanding</p>
                        <h3 id="analytics-outstanding">‚Çπ0</h3>
                    </div>
                </div>

                <div class="card">
                    <h3>Revenue Trends</h3>
                    <canvas id="analytics-chart"></canvas>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page" id="settings-page">
                <header class="page-header">
                    <div>
                        <h1>Settings</h1>
                        <p>Configure your preferences</p>
                    </div>
                    <button class="btn btn-primary" id="save-settings-btn">
                        <span class="icon">üíæ</span> Save Settings
                    </button>
                </header>

                <div class="settings-grid">
                    <div class="card">
                        <h3>Profile Information</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="profile-name" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="profile-email" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" id="profile-phone" class="form-control">
                            </div>
                            <div class="form-group full-width">
                                <label>Address</label>
                                <textarea id="profile-address" class="form-control" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label>GSTIN</label>
                                <input type="text" id="profile-gstin" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Banking Details</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Account Name</label>
                                <input type="text" id="bank-account-name" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Bank Name</label>
                                <input type="text" id="bank-name" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Account Number</label>
                                <input type="text" id="bank-account" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>IFSC Code</label>
                                <input type="text" id="bank-ifsc" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Invoice Settings</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Invoice Prefix</label>
                                <input type="text" id="invoice-prefix" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Tax Rate (%)</label>
                                <input type="number" id="tax-rate" class="form-control" min="0" max="100" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Currency</label>
                                <select id="currency" class="form-control">
                                    <option value="INR">INR (‚Çπ)</option>
                                    <option value="USD">USD ($)</option>
                                    <option value="EUR">EUR (‚Ç¨)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Invoice Modal -->
    <div class="modal" id="invoice-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="invoice-modal-title">Create Invoice</h2>
                <button class="modal-close" onclick="closeModal('invoice-modal')">√ó</button>
            </div>
            <form id="invoice-form" class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Invoice Number</label>
                        <input type="text" id="invoice-number" class="form-control" readonly>
                    </div>
                    <div class="form-group">
                        <label>Client</label>
                        <select id="invoice-client" class="form-control" required></select>
                    </div>
                    <div class="form-group">
                        <label>Issue Date</label>
                        <input type="date" id="issue-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" id="due-date" class="form-control" required>
                    </div>
                </div>

                <div class="line-items-section">
                    <div class="section-header">
                        <h3>Line Items</h3>
                        <button type="button" class="btn btn-sm" onclick="addLineItem()">Add Item</button>
                    </div>
                    <div id="line-items-container"></div>
                </div>

                <div class="invoice-summary">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="invoice-subtotal">‚Çπ0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>Tax (<span id="tax-percentage">0</span>%):</span>
                        <span id="invoice-tax">‚Çπ0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="invoice-total">‚Çπ0.00</span>
                    </div>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('invoice-modal')">Cancel</button>
                <button type="submit" form="invoice-form" class="btn btn-primary">Save Invoice</button>
            </div>
        </div>
    </div>

    <!-- Client Modal -->
    <div class="modal" id="client-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="client-modal-title">Add Client</h2>
                <button class="modal-close" onclick="closeModal('client-modal')">√ó</button>
            </div>
            <form id="client-form" class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Company Name *</label>
                        <input type="text" id="client-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Contact Person</label>
                        <input type="text" id="client-contact-name" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="client-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="client-phone" class="form-control">
                    </div>
                    <div class="form-group full-width">
                        <label>Address</label>
                        <textarea id="client-address" class="form-control" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Payment Terms</label>
                        <select id="client-terms" class="form-control">
                            <option value="net30">Net 30</option>
                            <option value="net15">Net 15</option>
                            <option value="due-on-receipt">Due on Receipt</option>
                        </select>
                    </div>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('client-modal')">Cancel</button>
                <button type="submit" form="client-form" class="btn btn-primary">Save Client</button>
            </div>
        </div>
    </div>

    <!-- Expense Modal -->
    <div class="modal" id="expense-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="expense-modal-title">Add Expense</h2>
                <button class="modal-close" onclick="closeModal('expense-modal')">√ó</button>
            </div>
            <form id="expense-form" class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Description *</label>
                        <input type="text" id="expense-description" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Amount *</label>
                        <input type="number" id="expense-amount" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="expense-category" class="form-control"></select>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="expense-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Payment Method</label>
                        <select id="expense-payment-method" class="form-control">
                            <option value="cash">Cash</option>
                            <option value="card">Card</option>
                            <option value="upi">UPI</option>
                            <option value="bank_transfer">Bank Transfer</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label>Notes</label>
                        <textarea id="expense-notes" class="form-control" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="expense-business">
                            <span>Business Expense</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="expense-tax-deductible">
                            <span>Tax Deductible</span>
                        </label>
                    </div>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('expense-modal')">Cancel</button>
                <button type="submit" form="expense-form" class="btn btn-primary">Save Expense</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>
</html>
